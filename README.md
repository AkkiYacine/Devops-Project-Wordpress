
# Wordpress Devops Project

The project aims to enable the deployment of a Wordpress containerised application running with its database service and its nginx reverse proxy server. This deployment is to be performed in two environments, a test environment and a production environment.

## Usage

1/ `./tools.sh` : to generate environments and deploy containers.  
2/ `./run.sh` : to start the different containers in both environments.  
3/ go to the browser and type http://locahost:80/ for the production environment wordpress site and on another page type http://locahost:8081/ for the test environment wordpress site. (I had to use port 8081 and not 8080 for the test environment as my home computer would not allow me to use port 8080, so you can change port 8081 by going to the `docker-compose.yml` file for the test environment and it will work).  
4/ `./clean.sh`: stop all containers and clean up the volumes and complete directory cleanup.

## Solution

I solved this problem by using docker technology and more specifically docker-compose. The solution will generate, with the help of the scripting tool tools.sh, our two test and production environments by deploying, in each of them, the user's Wordpress site through the implementation of three containers: a nginx container which will be used as a reverse proxy server, a wordpress service site container and a mysql database container. This deployment will be possible through the use of a docker-compose.yml configuration file that will be created in each environment.

* Illustration of Architecture of the test and production environments : Figure 1: architecture_devopsvfin

![architecture_devopsvfin](https://user-images.githubusercontent.com/101942400/176454958-bb6292f2-a907-4c53-89ae-ad54a045ca73.png)

### tools.sh

The tools.sh script is the base script file for the solution, once executed it will generate our two test and production environments within two folders called wordpress-test and wordpress-prod.
It will then create the files and folders needed to deploy the docker containers and configure the nginx proxy server for each environment. In addition to deploying, it will also ensure that each environment has the correct configuration by using specific environment variables.
Among these variables are the name of the site and the name of the user which will be requested at the time of the execution of the tool.

- Illustration of Folder structure generated by tools.sh : Figure 2: architecture_file

![architecture_file](https://user-images.githubusercontent.com/101942400/176542687-85675e9f-8cdb-45e6-b76d-99c86cf4f21c.png)

#### docker-compose.yml

The docker-compose.yml file is a configuration file that deploys the nginx reverse proxy server, the Wordpress site and the MySQL database.
This file is generated using the tools.sh script and is edited differently for test and production environments, using environment variables. For example the PORT variable used on the host by the nginx server container which will be 8080 for the test environment and 80 for production. 

#### volumes

I use a volume configuration in the docker-compose.yml files to persist the data of the different docker services and also make these volumes accessible for these services.

volume used by the nginx container :  
`volumes`  
`- ./nginx:/etc/nginx/conf.d`  
`- ./wordpress_data/wordpress:/var/www/html`

The nginx container has access to the host `./nginx` folder so that it can use the proxy server configuration.
It also uses the `./wordpress_data` directory where the files for the various static pages of the site are provided by the wordpress container and nginx uses it to render the static pages directly to the client. The request process is as follows:
The client sends its request to the nginx proxy server. The nginx proxy server forwards the request to the wordpress service which will process the request and send its response back to the proxy server which in turn will send the response back to the client. The wordpress service will process the request and modify the `./wordpress_data` volume which the nginx server will access after receiving the request back from the wordpress service.

volume used by the MySQL container :  
`volumes`  
`- ./db_data_wp/db_${DATABASE}:/var/lib/mysql`

This container uses the host directory `./db_data_wp/db_${DATABASE}` to persist the data. The `${DATABASE}` is a variable that will take a different value depending on whether we are in the test or production environment.

volume used by the wordpress container :  
`volumes`  
`- ./wordpress_data/wordpress:/var/www/html`

The "./wordpress_data/wordpress" directory of the host will be processed and updated by the wordpress service after receiving requests from the nginx proxy server. After processing the request, the wordpress service will return its response to the proxy so that it can send the response back to the client.


#### default.conf

This file is used to configure the nginx proxy server and allows this service to deliver the pages provided by the wordpress service. It is therefore also used to connect the nginx service to the wordpress service. The nginx server is therefore located between the client and the wordpress service, it plays its role of proxy server.



## List of containers and tools version

### tools

- Docker-Compose : version 1.26.2
- Docker : version 20.10.17
- Visual Studio Code : version 1.68.1

### containers

- Nginx : latest version
- Mysql : version 5.7
- Wordpress : version PHP 7.4

### files

- docker-compose.yml : version 3.8
